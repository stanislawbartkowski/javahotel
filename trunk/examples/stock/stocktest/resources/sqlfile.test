[setup]
-- check only if table exists
sql: SELECT COUNT(*) FROM PERSON
sql: SELECT COUNT(*) FROM ITEM
sql: SELECT COUNT(*) FROM STORE
sql: SELECT COUNT(*) FROM OPERATION
sql: SELECT COUNT(*) FROM OPERATIONLINE
sql: SELECT COUNT(*) FROM TEMP_ITEM_CODES_LIST
sql: SELECT COUNT(*) FROM TEMP_ITEM_IDS_LIST
sqlexception: DROP TABLE RES
sqlexception: CREATE TABLE RES (OK INT, OPID BIGINT)

[clear]
sql: { CALL CLEAR_ALL_STORES() }
sql: { CALL CLEAR_TEMP_SESSION(%(sessid)s) }
--sql: CALL CLEAR_TEMP_SESSION(%(sessid)s);
verify: SELECT COUNT(*) AS C FROM TEMP_ITEM_CODES_LIST WHERE SESSIONID=%(sessid)s
equal C 0
sql: INSERT INTO TEMP_ITEM_CODES_LIST VALUES('ANOTHERSESSION',
( SELECT CASE WHEN MAX(SEQNUMBER) IS NULL THEN 0 ELSE MAX(SEQNUMBER) + 1 END AS C  FROM TEMP_ITEM_CODES_LIST ),
'XXXX',5555,11111)
sql: INSERT INTO TEMP_ITEM_IDS_LIST VALUES('ANOTHERSESSION', 
( SELECT CASE WHEN MAX(SEQNUMBER) IS NULL THEN 0 ELSE MAX(SEQNUMBER) + 1 END AS C  FROM TEMP_ITEM_IDS_LIST ),
1, NULL, 10,10,100)

[modifyforrelease]
sql: UPDATE TEMP_ITEM_IDS_LIST SET AMOUNTRESERVED = AMOUNT WHERE SESSIONID=%(sessid)s

[modifyforreservation]
sql: UPDATE TEMP_ITEM_IDS_LIST SET AMOUNTRESERVED = AMOUNT, AMOUNT=NULL, VALUE=NULL WHERE SESSIONID=%(sessid)s


[deliveroneitem]
calltest: clear
sql: INSERT INTO TEMP_ITEM_CODES_LIST VALUES(%(sessid)s,1,'P002',1,2)
sql: BEGIN
  DECLARE OPID BIGINT;
  DECLARE OK INT;
  CALL GET_ITEM_IDS_FOR_DELIVERY(%(sessid)s,OK);
  CALL OPERATION_OP(%(sessid)s,OPID,'Augustus','Saturn');
END
sql: { CALL CLEAR_TEMP_SESSION(%(sessid)s) }



